!function(e){function t(t,a,n,s){var d="eyetab"+ ++r,i=e("<li>").addClass(s).append(e("<a>").attr("href","#"+d).text(t)),l=e("<textarea>").attr("id",d).addClass(s).data("link",i);return a.append(i),n.append(l),l}function a(a,r,n,s){var d=/([\d\w\-_]+)(?:\.[\d\w]+?)$/i.exec(a),i=d?d[1]:a,l=t(i,r,n,s);return e.ajax(a).done(function(e){l.val(e.trimRight()),l.data("link").attr("title",a)}).fail(function(){l.addClass("error").val("Could not load "+a+"."),l.data("link").addClass("error")}),l}var r=0,n=e.fn.eye=function(r){return this.each(function(){function n(){var a=[],n=$queryTab.val();e(x).each(function(){e(this).hasClass("error")||a.push(e(this).val())}),f.text(d.executing).removeClass("error"),s({path:r.path,data:a,query:n}).done(function(e){var a="result "+ ++i;f.text(d.success.replace("$",a)),t(a,v,h,"result").text(e),h.tabs("destroy").tabs().tabs("select",i-1).slideDown()}).fail(function(e){f.text(d.failure.replace("$",e)).addClass("error")})}var i=0;r=r||{};var l=e(this).addClass("eye"),o=e("<div>").addClass("old").append(l.children()),c=e("<ul>").append(e('<li class="label">').text(d.input)),u=e("<div>").addClass("data"),p=e("<button>"),f=e("<span>"),v=e("<ul>").append(e('<li class="label">').text(d.results)),h=e("<div>").addClass("results"),y=e("<div>").addClass("client");l.append(o,y.append(u.append(c),e("<p>").append(p,f),h.append(v)));var x=[];o.find(".data").each(function(){var t=e(this),r=t.attr("href")||t.text();x.push(a(r,c,u,"data"))});o.find(".query").each(function(){var t=e(this),r=t.attr("href")||t.text();$queryTab=a(r,c,u,"query")}),u.tabs(),h.tabs().hide(),p.button().text(d.execute).click(n)})},s=n.executeEye=function(t){return e.Deferred(function(a){e.ajax({url:t.path,traditional:!0,data:{data:t.data,query:t.query},cache:!0,type:e.support.cors?"POST":"GET",dataType:e.support.cors?"text":"jsonp"}).done(function(e){e.error?a.reject(e.error):a.resolve(e.trimRight())}).fail(function(e){a.reject(e.responseText?e.responseText.trim():e.status?"HTTP error "+e.status+" \u2013 "+e.statusText:"Unknown HTTP error. Check your connection")})}).promise()},d=n.labels={input:"Input",results:"Results",execute:"Execute EYE",executing:"Executing EYE...",success:"EYE generated $, displayed below.",failure:"Error executing EYE: $."}}(jQuery),function(e){function t(){var t=r.scrollTop();return e(".eye div.client").slideUp("fast",function(){e(".eye div.old").fadeIn("fast"),r.scrollTop(t)}),e(".displaymode .cmd").addClass("active"),e(".displaymode .client").removeClass("active"),r.scrollTop(t),!1}function a(){var t=r.scrollTop();return e(".eye div.old").fadeOut("fast",function(){var a=window.setInterval(function(){r.scrollTop(t)},10);e(".eye div.client").slideDown("fast",function(){window.clearInterval(a)})}),e(".displaymode .cmd").removeClass("active"),e(".displaymode .client").addClass("active"),r.scrollTop(t),!1}var r=e("body");e(".eye").eye({path:"https://eye.restdesc.org/"}).each(function(){e(".old",this).hide(),e(".client",this);e(this).prepend(e("<ul>").addClass("displaymode").append(e("<li>").addClass("cmd").append(e("<a>").attr("href","#").text("EYE offline").click(t)),e("<li>").addClass("client active").append(e("<a>").attr("href","#").text("EYE online").click(a))))})}(jQuery);
